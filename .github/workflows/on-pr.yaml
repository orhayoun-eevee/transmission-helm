name: PR Validation

on:
  pull_request:
    branches:
      - main

concurrency:
  group: pr-validation-${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

permissions:
  contents: read
  packages: read
  issues: write
  pull-requests: write

jobs:
  validate:
    name: Validate Transmission Chart
    uses: orhayoun-eevee/build-workflow/.github/workflows/helm-validate.yaml@v0.1.0
    with:
      chart_path: .
      kubernetes_version: "1.30.0"
      scenarios_dir: tests/scenarios
      snapshots_dir: tests/snapshots
      run_syntax: true
      run_schema: true
      run_metadata: true
      run_tests: true
      run_policy: true
      target_branch: main
      run_version_check: true
      build_workflow_ref: "v0.1.0"
      docker_image: "ghcr.io/orhayoun-eevee/helm-validate:v0.1.0@sha256:f63114842c9234761efbd9f8a16a86b188fd9c8c14152f40c9e84c7fa29b39a7"
    secrets:
      gh_app_id: ${{ secrets.GHCR_AUTO_APP_ID }}
      gh_app_private_key: ${{ secrets.GHCR_AUTO_PKEY }}
