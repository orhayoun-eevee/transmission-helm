suite: transmission workload overrides
templates:
  - templates/all.yaml
tests:
  - it: applies deployment replica override
    set:
      deployment:
        replicas: 2
    asserts:
      - documentSelector:
          path: kind
          value: Deployment
        equal:
          path: spec.replicas
          value: 2

  - it: applies pod security context fsGroup override
    set:
      deployment:
        podSecurityContext:
          fsGroup: 2000
    asserts:
      - documentSelector:
          path: kind
          value: Deployment
        equal:
          path: spec.template.spec.securityContext.fsGroup
          value: 2000

  - it: applies persistence pvc size override
    set:
      persistence:
        claims:
          config:
            size: 2Gi
    asserts:
      - documentSelector:
          path: metadata.name
          value: transmission-config
        equal:
          path: spec.resources.requests.storage
          value: 2Gi

  - it: applies persistence storageClass override
    set:
      persistence:
        claims:
          config:
            storageClass: fast-local
    asserts:
      - documentSelector:
          path: metadata.name
          value: transmission-config
        equal:
          path: spec.storageClassName
          value: fast-local

  - it: applies destination rule host override in workload suite
    set:
      network:
        istio:
          destinationRule:
            host: transmission-override-http
    asserts:
      - documentSelector:
          path: kind
          value: DestinationRule
        equal:
          path: spec.host
          value: transmission-override-http
